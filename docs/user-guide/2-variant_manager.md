# Variant Manager

## Introduction

The variant manager in Antares Web allows users to easily manage multiple scenarios of electricity consumption and
production in France and Europe, in order to maintain a balance between supply and demand. This feature enables users to
create and configure variants, which are slightly modified versions of the base study used as a reference.

It is important to note that variant management is currently applicable only to "managed" studies available in the
"default" workspace. Any modifications made to a variant are recorded as a list of commands in the variant's history.
The user interface provides options to view and delete these commands, allowing users to undo changes if needed.
Additionally, variant configurations can be modified programmatically using the API. For example, the GET
endpoint `/v1/studies/{uuid}/commands` lists the commands associated with a variant, while the POST
endpoint `/v1/studies/{uuid}/command` adds a command to a variant.

The following documentation describes the variant manager and provides a list of available commands.

## Managing Study Variants

Commands in the variant manager are actions that define modifications to the study's configuration.
Each command consists of an "action" and "args" field. The "action" field specifies the type of modification to be
performed, while the "args" field contains the parameters required for that action. For example, the
command `"action": "create_area"` creates a new area, and the corresponding `"args"` object specifies the name of the
area to be created. Similarly, the command `"action": "create_link"` creates a link between two areas, with the "args"
object providing the names of the two areas to be connected. Users can create multiple commands within a single variant
to define complex configurations.

The example provided bellow demonstrates the creation of two areas and a link between them:

```json
[
  {
    "action": "create_area",
    "args": {
      "area_name": "new area"
    }
  },
  {
    "action": "create_area",
    "args": {
      "area_name": "new area 2"
    }
  },
  {
    "action": "create_link",
    "args": {
      "area1": "new area",
      "area2": "new area 2"
    }
  }
]
```

## Command list

### Base commands

| Action Name               | Arguments                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Description                                                                                 |
|---------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|
| update_config             | <pre>{<br>target:&nbsp;&lt;INI_TARGET&gt;<br>data:&nbsp;&lt;INI_MODEL&gt;<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Update arbitrary config                                                                     |
| replace_matrix            | <pre>{<br>target:&nbsp;&lt;INPUT_SERIES_MATRIX&gt;<br>matrix:&nbsp;&lt;MATRIX&gt;<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Replace arbitrary matrix                                                                    |
| create_area               | <pre>{<br>area_name:&nbsp;&lt;STRING&gt;<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Create a new area                                                                           |
| remove_area               | <pre>{<br>id:&nbsp;&lt;AREA_ID&gt;<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Remove an existing area                                                                     |
| create_cluster            | <pre>{<br>area_id:&nbsp;&lt;AREA_ID&gt;<br>cluster_name:&nbsp;&lt;STRING&gt;<br>prepro?:&nbsp;&lt;STRING&gt;<br>modulation?:&nbsp;&lt;MATRIX&gt;<br>parameters?:&nbsp;&lt;INI_MODEL&gt;<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Create a new thermal cluster                                                                |
| remove_cluster            | <pre>{<br>area_id:&nbsp;&lt;AREA_ID&gt;<br>cluster_id:&nbsp;&lt;CLUSTER_ID&gt;<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Remove an existing thermal cluster                                                          |
| create_renewables_cluster | <pre>{<br>area_id:&nbsp;&lt;AREA_ID&gt;<br>cluster_name:&nbsp;&lt;STRING&gt;<br>parameters?:&nbsp;&lt;INI_MODEL&gt;<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Create a new renewable cluster                                                              |
| remove_renewables_cluster | <pre>{<br>area_id:&nbsp;&lt;AREA_ID&gt;<br>cluster_id:&nbsp;&lt;CLUSTER_ID&gt;<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Remove an existing renewable cluster                                                        |
| create_link               | <pre>{<br>area1:&nbsp;&lt;AREA_ID&gt;<br>area2:&nbsp;&lt;AREA_ID&gt;<br>parameters?:&nbsp;&lt;INI_MODEL&gt;<br>series?:&nbsp;&lt;MATRIX&gt;<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Create a new link                                                                           |
| remove_link               | <pre>{<br>area1:&nbsp;&lt;AREA_ID&gt;<br>area2:&nbsp;&lt;AREA_ID&gt;<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Remove an existing link                                                                     |
| create_district           | <pre>{<br>name:&nbsp;&lt;STRING&gt;<br>base_filter?:&nbsp;"add-all" &#124; <b>"remove-all"</b><br>filter_items?:&nbsp;&lt;LIST&#91;AREA_ID&#93;&gt;<br>output?:&nbsp;&lt;BOOLEAN&gt; (default: True)<br>comments?:&nbsp;&lt;STRING&gt;<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Create a new district (set of areas)                                                        |
| remove_district           | <pre>{<br>id:&nbsp;&lt;DISTRICT_ID&gt;<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Remove an existing district                                                                 |
| create_binding_constraint | <pre>{<br>name:&nbsp;&lt;STRING&gt;<br>enabled?:&nbsp;&lt;BOOLEAN&gt; (default: True)<br>time_step:&nbsp;"hourly" &#124; "weekly" &#124; "daily"<br>operator:&nbsp;"equal" &#124; "both" &#124; "greater" &#124; "less"<br>coeffs:&nbsp;&lt;LIST&#91;CONSTRAINT_COEFF&#93;&gt;<br>values?:&nbsp;&lt;MATRIX&gt;<br>comments?:&nbsp;&lt;STRING&gt;<br>}</pre><br>CONSTRAINT_COEFF<pre>{<br>type:&nbsp;&lt;"cluster" &#124; "link" (choosing one or the other imply filling the right corresponding parameter below)&gt;<br>link:&nbsp;&lt;AREA_ID&gt;%&lt;AREA_ID&gt; (link)<br>cluster:&nbsp;&lt;AREA_ID&gt;.&lt;CLUSTER_ID&gt;<br>coeff:&nbsp;&lt;NUMBER&gt;<br>offset?:&nbsp;&lt;NUMBER&gt;<br>}</pre> | Create a new binding constraint                                                             |
| update_binding_constraint | <pre>{<br>id:&nbsp;&lt;BINDING_CONSTRAINT_ID&gt;<br>enabled?:&nbsp;&lt;BOOLEAN&gt; (default: True)<br>time_step:&nbsp;"hourly" &#124; "weekly" &#124; "daily"<br>operator:&nbsp;"equal" &#124; "both" &#124; "greater" &#124; "less"<br>coeffs:&nbsp;&lt;LIST&#91;CONSTRAINT_COEFF&#93;&gt;<br>values?:&nbsp;&lt;MATRIX&gt;<br>comments?:&nbsp;&lt;STRING&gt;<br>}</pre>                                                                                                                                                                                                                                                                                                                                | Update an existing binding constraint                                                       |
| remove_binding_constraint | <pre>{<br>id:&nbsp;&lt;BINDING_CONSTRAINT_ID&gt;<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Remove an existing binding constraint                                                       |
| update_playlist           | <pre>{<br>active:&nbsp;&lt;BOOLEAN&gt; (default: True)<br>reverse:&nbsp;&lt;BOOLEAN&gt; (default: False)<br>items:&nbsp;&lt;LIST&#91;NUMBER&#93;&gt; (default: None)<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Update the playlist with provided active (or inactive) years (starting from year 1)         |
| update_scenario_builder   | <pre>{<br>data:&nbsp;&lt;RULESETS_MODEL&gt; <br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Update scenario builder with partial configuration                                          |
| update_district           | <pre>{<br>id:&nbsp;&lt;STRING&gt;<br>base_filter?:&nbsp;"add-all" &#124; <b>"remove-all"</b><br>filter_items?:&nbsp;&lt;LIST&#91;AREA_ID&#93;&gt;<br>output?:&nbsp;&lt;BOOLEAN&gt; (default: True)<br>comments?:&nbsp;&lt;STRING&gt;<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Update a district (set of areas)                                                            |
| update_raw_file           | <pre>{<br>target:&nbsp;&lt;INPUT_RAW_FILE_TARGET&gt;<br>b64Data:&nbsp;&lt;STRING&gt;<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Replace arbitrary data file (must not be a matrix or ini target) with a base64 encoded data |

#### Base types

| Type                       | Description                                                                                                                                                                                                             |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| STRING                     | any string value                                                                                                                                                                                                        |
| NUMBER                     | any integer or float                                                                                                                                                                                                    |
| BOOLEAN                    | true or false                                                                                                                                                                                                           |
| INI_TARGET                 | a valid antares file relative path (without extension). The path can be found when browsing the study in detailed view                                                                                                  |
| INI_MODEL                  | a json with a valid field corresponding to the ini file targeted                                                                                                                                                        |
| RULESETS_MODEL             | like `INI_MODEL` with some specifications: an empty string allows to remove a key (ruleset or cell value) and a ruleset "A" with for value the name of an another ruleset "B" allows to clone the content of "B" in "A" |
| INPUT_RAW_FILE_TARGET      | a valid antares raw data file relative path (without extension). The path can be found when browsing the study in detailed view                                                                                         |
| INPUT_SERIES_MATRIX_TARGET | a valid antares matrix data file relative path (without extension). The path can be found when browsing the study in detailed view                                                                                      |
| MATRIX                     | a matrix id or a list of list of values (eg. &#91;&#91;0,1,2&#93;,&#91;4,5,6&#93;&#93; where each sub list is a row of the matrix). Matrix id can be found in the Matrix Data manager tab.                              |
| AREA_ID                    | the id of an area (same as name, but lower cased and only with the following characters: &#91;a-z&#93;,&#91;0-9&#93;_,(,),-,&,",". Other characters will be transformed into a single space.)                           |
| CLUSTER_ID                 | the id of a cluster (same as name, but lower cased and only with the following characters: &#91;a-z&#93;,&#91;0-9&#93;_,(,),-,&,",". Other characters will be transformed into a single space.)                         |
| DISTRICT_ID                | the id of a district (same as name, but lower cased and only with the following characters: &#91;a-z&#93;,&#91;0-9&#93;_,(,),-,&,",". Other characters will be transformed into a single space.)                        |
| BINDING_CONSTRAINT_ID      | the id of a binding constraint (same as name, but lower cased and only with the following characters: &#91;a-z&#93;,&#91;0-9&#93;_,(,),-,&,",". Other characters will be transformed into a single space.)              |

### Specialized commands

Coming soon

### Composite commands

Comming soon

## CLI Tool

The CLI tool (`AntaresTool`) is bundled
within [AntaresWeb releases](https://github.com/AntaresSimulatorTeam/AntaREST/releases).

It provides 3 commands :

- `apply-script` will modify a study using commands found in a directory that contain a file `commands.json` and an
  optional folder named `matrices` which contains matrices used in the commands.
- `generate-script` will transform a study into a commands file and matrices directory
- `generate-script-diff` will take two commands file (and associated matrices directory) and will output a new one
  consisting of the differences between the two variants